(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{157:function(e,t,a){},197:function(e,t,a){},199:function(e,t,a){},249:function(e,t,a){"use strict";a.r(t);var s=a(31),n=a(11),r=a(17),o=a(22),c=a(19),i=a(18),l=a(20),h=a(5),m=a(0),d=a.n(m),u=a(2),g=a(12),f=a(21),p=a(156),b=a.n(p),v=a(25),C=a.n(v),U=function(e){var t=e.id,a=e.firstName,s=e.lastName,n=e.online,r=e.profilePicUrl||C.a,o="";r&&(o=u.b.getImageSize(r));var c=u.b.formatUsername(a,s,21),i=n?"online-status":"offline-status";return d.a.createElement("div",{className:"messagebox-friend-container",onClick:function(n){return e.showUserChatBox({id:t,firstName:a,lastName:s,profilePicUrl:r},n)}},d.a.createElement("i",{className:"fas fa-circle ".concat(i)}),d.a.createElement("div",{className:"messagebox-friend-image"},d.a.createElement("img",{className:o,src:r,alt:"profilePic"})),d.a.createElement("div",{className:"messagebox-username-container"},d.a.createElement("p",{className:"messagebox-username"},c," ")))},N=(a(197),function(e){var t=e.content,a=e.fromUserId,s=e.time,n="";a===u.b.getUserId()&&(n="loggedInUser");var r=e.time.hour<=12?"AM":"PM",o=e.time.month.substring(0,1)+e.time.month.substring(1,5).toLowerCase(),c=e.time.hour<10?"0"+e.time.hour:e.time.hour,i=e.time.minute<10?"0"+e.time.minute:e.time.minute,l=e.fromUserProfilePicUrl||C.a,h="";return l&&(h=u.b.getImageSize(l)),d.a.createElement("div",{className:"message-container"},d.a.createElement("div",{className:"message-image ".concat(n)},d.a.createElement("img",{className:h,src:l,alt:"creatorPic"})),d.a.createElement("div",{className:"message-description"},d.a.createElement("p",{className:"message-content ".concat(n)}," ",t," "),d.a.createElement("div",{className:"message-info ".concat(n)},d.a.createElement("p",{className:"message-time"}," ",s.dayOfMonth," ",o," ",c,":",i," ",r))))}),E=(a(157),a(199),a(24)),O=a(42),A=a(38),y=a(201),S=a.n(y),x=a(207),B=a.n(x),M=function(e){function t(e){var a;return Object(r.a)(this,t),(a=Object(c.a)(this,Object(i.a)(t).call(this,e))).initializeWebSocketConnection=function(){var e=new B.a(a.serverUrl);a.stompClient=S.a.over(e);var t=a.getAuthHeader();a.stompClient.connect(t,function(e){a._isMounted&&(a.setState({clientConnected:!0}),a.stompClient.subscribe("/user/queue/position-update",function(e){if(e.body){var t=JSON.parse(e.body);if(!a._isMounted||t.fromUserId!==a.state.chatUserId&&t.fromUserId!==u.b.getUserId()||a.props.addMessage(t),t.fromUserId!==u.b.getUserId()){var s=u.b.formatUsername(t.fromUserFirstName,t.fromUserLastName);g.toast.info(d.a.createElement(f.d.infoToast,{text:"You have a new message from ".concat(s,"!")}),{position:g.toast.POSITION.TOP_RIGHT}),a.props.loadAllUnreadMessages()}}}),a.stompClient.subscribe("/chat/login",function(e){if(e.body){var t=JSON.parse(e.body);a.changeUserOnlineStatus(t)}}),a.stompClient.subscribe("/chat/logout",function(e){if(e.body){var t=JSON.parse(e.body);a.changeUserOnlineStatus(t)}}))},function(){g.toast.error(d.a.createElement(f.d.errorToast,{text:"Lost connection to ".concat(a.serverUrl,". Refresh the page to reconnect.")}),{position:g.toast.POSITION.TOP_RIGHT})})},a.getAuthHeader=function(){var e=localStorage.getItem("token");return e&&e.length?{Authorization:"Bearer ".concat(e)}:{}},a.getAllMessages=function(e){a.props.fetchAllMessages(e)},a.loadAllChatFriends=function(){var e=u.b.getUserId();a.props.loadAllChatFriends(e)},a.handleBlur=function(e){return function(t){a.setState({touched:Object(n.a)({},a.state.touched,Object(s.a)({},e,!0))})}},a.validate=function(e){return{content:0===e.length}},a.changeHeight=function(){""===a.state.userBoxHeight?a.setState({userBoxHeight:"toggle"}):a.setState({userBoxHeight:""})},a.changeChatBoxHeight=function(){""===a.state.chatBoxHeight?a.setState({chatBoxHeight:"toggle-chat-container"}):a.setState({chatBoxHeight:""})},a.changeChatBoxDisplay=function(){""===a.state.chatBoxDisplay?a.setState({chatBoxDisplay:"display-none"}):a.setState({chatBoxDisplay:""})},a.showUserChatBox=function(e,t){var s=e.id,n=e.firstName,r=e.lastName,o=e.profilePicUrl,c=u.b.formatUsername(n,r,18);a.setState({chatUserId:s,chatUserFirstName:n,chatUserLastName:r,chatUserNameFormatted:c,chatUserProfilePicUrl:o,shouldScrollDown:!0,chatBoxDisplay:"",chatBoxHeight:"",content:""},function(){a.getAllMessages(s)})},a.closeUserChatBox=function(){a.setState({chatBoxDisplay:"display-none"})},a.getOnlineUserCount=function(){return a.props.friendsChatArr.filter(function(e){return!0===e.online}).length},a.state={loggedInUserId:"",chatUserId:"",chatUserFirstName:"",chatUserLastName:"",chatUserNameFormatted:"",chatUserProfilePicUrl:"",userBoxHeight:"toggle",chatBoxHeight:"",chatBoxDisplay:"display-none",content:"",shouldScrollDown:!1,friendsArrLength:0,clientConnected:!1,touched:{content:!1}},a._isMounted=!1,a.serverUrl=u.b.getBaseUrl()+"/socket",a.stompClient=null,a.handleBlur=a.handleBlur.bind(Object(h.a)(Object(h.a)(a))),a.onChangeHandler=a.onChangeHandler.bind(Object(h.a)(Object(h.a)(a))),a.onSubmitHandler=a.onSubmitHandler.bind(Object(h.a)(Object(h.a)(a))),a.showUserChatBox=a.showUserChatBox.bind(Object(h.a)(Object(h.a)(a))),a.changeChatBoxDisplay=a.changeChatBoxDisplay.bind(Object(h.a)(Object(h.a)(a))),a.getAllMessages=a.getAllMessages.bind(Object(h.a)(Object(h.a)(a))),a.loadAllChatFriends=a.loadAllChatFriends.bind(Object(h.a)(Object(h.a)(a))),a}return Object(l.a)(t,e),Object(o.a)(t,[{key:"componentDidMount",value:function(){var e=u.b.getUserId();this.setState({loggedInUserId:e}),this.initializeWebSocketConnection(),this.loadAllChatFriends(),this._isMounted=!0}},{key:"componentDidUpdate",value:function(e,t){var a=this;if(this.props.allMessagesArr!==e.allMessagesArr&&this.setState({content:""},function(){a.state.shouldScrollDown?a.scrollDown():a.setState({shouldScrollDown:!0},a.scrollTop())}),this.props.friendsChatArr.length!==e.friendsChatArr.length&&this.setState({chatBoxDisplay:"display-none"}),this.props.triggerMessageLoad!==e.triggerMessageLoad){var s=this.props.triggerMessageLoad;this.showUserChatBox(s)}var n=this.getErrorMessage(e,t),r=this.getSuccessMessage(e,t);n?g.toast.error(d.a.createElement(f.d.errorToast,{text:n}),{position:g.toast.POSITION.TOP_RIGHT}):r&&g.toast.success(d.a.createElement(f.d.successToast,{text:r}),{position:g.toast.POSITION.TOP_RIGHT})}},{key:"componentWillUnmount",value:function(){this.stompClient.disconnect(),this._isMounted=!1}},{key:"getSuccessMessage",value:function(e,t){return!this.props.fetchAllChatFriends.hasError&&this.props.fetchAllChatFriends.message&&this.props.fetchAllChatFriends!==e.fetchAllChatFriends?this.props.fetchAllChatFriends.message:!this.props.fetchAllMessages.hasError&&this.props.fetchAllMessages.message&&this.props.fetchAllMessages!==e.fetchAllMessages?this.props.fetchAllMessages.message:null}},{key:"getErrorMessage",value:function(e,t){return this.props.fetchAllChatFriends.hasError&&e.fetchAllChatFriends.error!==this.props.fetchAllChatFriends.error?this.props.fetchAllChatFriends.message||"Server Error":this.props.fetchAllMessages.hasError&&e.fetchAllMessages.error!==this.props.fetchAllMessages.error?this.props.fetchAllMessages.message||"Server Error":null}},{key:"sendMessage",value:function(e){this.stompClient.send("/app/message",{},JSON.stringify(e)),this.setState({content:""})}},{key:"onSubmitHandler",value:function(e){if(e.preventDefault(),this.canBeSubmitted()){var t=this.state,a=t.chatUserId,s=t.content;this.state.clientConnected?this.sendMessage({toUserId:a,content:s}):g.toast.error(d.a.createElement(f.d.errorToast,{text:"StompClient is disconnected"}),{position:g.toast.POSITION.TOP_RIGHT})}}},{key:"onChangeHandler",value:function(e){this.setState(Object(s.a)({},e.target.name,e.target.value))}},{key:"canBeSubmitted",value:function(){var e=this.state.content,t=this.validate(e);return!Object.keys(t).some(function(e){return t[e]})}},{key:"scrollToBottom",value:function(){var e=document.getElementById("chat-content");e.scrollTop=e.scrollHeight-e.getBoundingClientRect().height}},{key:"scrollTop",value:function(){document.getElementById("chat-content").scrollTop=0}},{key:"scrollDown",value:function(){var e=document.getElementById("chat-content");e.scrollTop=e.scrollHeight}},{key:"changeUserOnlineStatus",value:function(e){var t=e.userId,a=e.online;this.props.updateUserStatus({id:t,online:a})}},{key:"render",value:function(){var e=this;if(!this.state.clientConnected)return console.log("Connecting..."),d.a.createElement("h1",{className:"text-center pt-5 mt-5"},"Connecting...");var t=this.state.content,a=this.validate(t),s=!Object.keys(a).some(function(e){return a[e]}),n=s?"":"hidden",r=u.b.getFirstName(),o=this.state.userBoxHeight,c=this.state.chatBoxHeight,i=this.state.chatBoxDisplay,l=this.state,h=l.chatUserProfilePicUrl,g=l.chatUserNameFormatted,f=u.b.getImageSize(h),p=u.b.formatUsername(r);return d.a.createElement(m.Fragment,null,d.a.createElement("section",{className:"messagebox-container ".concat(o)},d.a.createElement("div",{className:"messagebox-header",onClick:this.changeHeight},d.a.createElement("div",{className:"messagebox-chat-icon"},d.a.createElement("i",{className:"fas fa-location-arrow"})),d.a.createElement("h4",{className:"chat-title",style:{color:" #333"}},"Chat \u2022 ",this.getOnlineUserCount())),d.a.createElement("div",{className:"messagebox-friendsChatArr-wrapper"},this.props.friendsChatArr.map(function(t){return d.a.createElement(U,Object.assign({key:t.id,showUserChatBox:e.showUserChatBox},t))}))),d.a.createElement("section",{className:"chat-container ".concat(c," ").concat(i),id:"chat-container"},d.a.createElement("div",{className:"chat-friend-container",onClick:this.changeChatBoxHeight},d.a.createElement("div",{className:"chat-friend-image"},d.a.createElement("img",{className:f,src:h,alt:"bender"})),d.a.createElement("div",{className:"chat-username-container"},d.a.createElement("p",{className:"chat-username"},g))),d.a.createElement("div",{className:"close-button-container",onClick:this.closeUserChatBox},d.a.createElement("div",{className:"btn chat-uiButtonGroup chat-fbPhotoCurationControl  chat-delete-button"},d.a.createElement("i",{className:"fas fa-times"}))),d.a.createElement("div",{className:"content-wrapper"},d.a.createElement("div",{className:"chat-content",id:"chat-content"},this.props.allMessagesArr.map(function(e){return d.a.createElement(N,Object.assign({key:e.id},e))})),d.a.createElement("div",{className:"chat-footer"},d.a.createElement("div",{className:"chat-input-group"},d.a.createElement("div",{className:"chat-area-container"},d.a.createElement("form",{onSubmit:this.onSubmitHandler},d.a.createElement("div",{className:"",id:"chat-textarea-form-group"},d.a.createElement(b.a,{name:"content",id:"content",className:"chat-textarea",value:this.state.content,onChange:this.onChangeHandler,onBlur:this.handleBlur("content"),"aria-describedby":"contentHelp",placeholder:"Type your message, ".concat(p,"?"),maxRows:6})),d.a.createElement("div",{className:"text-center"},d.a.createElement("button",{disabled:!s,style:{visibility:"".concat(n)},type:"submit",className:"btn fas fa-location-arrow App-button-primary send-btn"})))))))))}}]),t}(m.Component);t.default=Object(E.b)(function(e){return{friendsChatArr:e.fetchAllChatFriends.friendsChatArr,fetchAllChatFriends:e.fetchAllChatFriends,allMessagesArr:e.fetchAllMessages.allMessagesArr,fetchAllMessages:e.fetchAllMessages,triggerMessageLoad:e.triggerMessageLoad}},function(e){return{loadAllChatFriends:function(t){e(Object(O.h)(t))},fetchAllMessages:function(t){e(Object(A.b)(t))},updateUserStatus:function(t){e(Object(O.r)(t))},addMessage:function(t){e(Object(A.a)(t))},loadAllUnreadMessages:function(){e(Object(A.c)())}}})(M)}}]);
//# sourceMappingURL=15.53d3facc.chunk.js.map